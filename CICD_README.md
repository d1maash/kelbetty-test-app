# üöÄ CI/CD Pipeline –¥–ª—è Kelbetty

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫—É –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CI/CD –ø–∞–π–ø–ª–∞–π–Ω–∞ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, —Å–±–æ—Ä–∫–∏ –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Kelbetty.

## üìã –û–±–∑–æ—Ä

CI/CD –ø–∞–π–ø–ª–∞–π–Ω —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —Ç—Ä–µ—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö workflow:

1. **üß™ CI (Continuous Integration)** - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞
2. **üèóÔ∏è Build** - —Å–±–æ—Ä–∫–∞ –∏ –ø—É–±–ª–∏–∫–∞—Ü–∏—è Docker –æ–±—Ä–∞–∑–æ–≤
3. **üöÄ Deploy** - —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ staging –∏ production —Å–µ—Ä–≤–µ—Ä—ã

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. GitHub Secrets

–î–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è (`Settings > Secrets and variables > Actions`):

#### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Å–µ–∫—Ä–µ—Ç—ã:
```bash
# Docker Registry
GITHUB_TOKEN  # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ—Å—Ç—É–ø–µ–Ω

# Staging —Å–µ—Ä–≤–µ—Ä
STAGING_HOST=your-staging-server.com
STAGING_USER=deploy
STAGING_SSH_KEY=your-private-ssh-key
STAGING_URL=https://staging.your-domain.com

# Production —Å–µ—Ä–≤–µ—Ä
PRODUCTION_HOST=your-production-server.com
PRODUCTION_USER=deploy
PRODUCTION_SSH_KEY=your-private-ssh-key
PRODUCTION_URL=https://your-domain.com

# –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
SNYK_TOKEN=your-snyk-token  # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
```

#### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Å–µ–∫—Ä–µ—Ç—ã:
```bash
# –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
SLACK_WEBHOOK_URL=your-slack-webhook
EMAIL_SMTP_HOST=smtp.gmail.com
EMAIL_SMTP_PORT=587
EMAIL_SMTP_USER=your-email@gmail.com
EMAIL_SMTP_PASS=your-app-password
EMAIL_TO=admin@your-domain.com
EMAIL_FROM=noreply@your-domain.com
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–µ—Ä–æ–≤

#### Staging —Å–µ—Ä–≤–µ—Ä:
```bash
# –°–æ–∑–¥–∞–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –¥–µ–ø–ª–æ—è
sudo adduser deploy
sudo usermod -aG docker deploy

# –°–æ–∑–¥–∞–π—Ç–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
sudo mkdir -p /opt/kelbetty-staging
sudo chown deploy:deploy /opt/kelbetty-staging

# –ù–∞—Å—Ç—Ä–æ–π—Ç–µ SSH –∫–ª—é—á–∏
sudo -u deploy mkdir -p /home/deploy/.ssh
# –î–æ–±–∞–≤—å—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –≤ /home/deploy/.ssh/authorized_keys
```

#### Production —Å–µ—Ä–≤–µ—Ä:
```bash
# –°–æ–∑–¥–∞–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –¥–µ–ø–ª–æ—è
sudo adduser deploy
sudo usermod -aG docker deploy

# –°–æ–∑–¥–∞–π—Ç–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
sudo mkdir -p /opt/kelbetty-production
sudo chown deploy:deploy /opt/kelbetty-production

# –ù–∞—Å—Ç—Ä–æ–π—Ç–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
sudo mkdir -p /opt/kelbetty-production/ssl
# –ü–æ–º–µ—Å—Ç–∏—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –≤ ssl/cert.pem –∏ ssl/key.pem

# –ù–∞—Å—Ç—Ä–æ–π—Ç–µ SSH –∫–ª—é—á–∏
sudo -u deploy mkdir -p /home/deploy/.ssh
# –î–æ–±–∞–≤—å—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –≤ /home/deploy/.ssh/authorized_keys
```

## üîÑ Workflow –û–ø–∏—Å–∞–Ω–∏–µ

### 1. CI Workflow (`.github/workflows/ci.yml`)

**–¢—Ä–∏–≥–≥–µ—Ä—ã:**
- Push –≤ `main`, `dev`, `dev-test` –≤–µ—Ç–∫–∏
- Pull Request –≤ `main`, `dev` –≤–µ—Ç–∫–∏

**–≠—Ç–∞–ø—ã:**
1. **üîç –õ–∏–Ω—Ç–∏–Ω–≥** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ —Å ESLint
2. **üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ —Å PostgreSQL
3. **üê≥ Docker —Å–±–æ—Ä–∫–∞** - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–±–æ—Ä–∫–∏ Docker –æ–±—Ä–∞–∑–∞
4. **üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –∞—É–¥–∏—Ç npm –∏ Snyk —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

### 2. Build Workflow (`.github/workflows/build.yml`)

**–¢—Ä–∏–≥–≥–µ—Ä—ã:**
- Push –≤ `main` –≤–µ—Ç–∫—É
- –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ–≥–æ–≤ `v*`
- –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫

**–≠—Ç–∞–ø—ã:**
1. **üèóÔ∏è –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–æ–≤** - —Å–æ–∑–¥–∞–Ω–∏–µ Docker –æ–±—Ä–∞–∑–æ–≤ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º
2. **üì§ –ü—É–±–ª–∏–∫–∞—Ü–∏—è** - –∑–∞–≥—Ä—É–∑–∫–∞ –≤ GitHub Container Registry
3. **üîí –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –æ–±—Ä–∞–∑–æ–≤
4. **üöÄ –†–µ–ª–∏–∑** - —Å–æ–∑–¥–∞–Ω–∏–µ GitHub —Ä–µ–ª–∏–∑–∞ (–¥–ª—è —Ç–µ–≥–æ–≤)

### 3. Deploy Workflow (`.github/workflows/deploy.yml`)

**–¢—Ä–∏–≥–≥–µ—Ä—ã:**
- Push –≤ `main` –≤–µ—Ç–∫—É (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π –Ω–∞ staging)
- –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ (–≤—ã–±–æ—Ä –æ–∫—Ä—É–∂–µ–Ω–∏—è)

**–≠—Ç–∞–ø—ã:**
1. **‚úÖ –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏** - –ø—Ä–æ–≤–µ—Ä–∫–∞ CI —Å—Ç–∞—Ç—É—Å–∞
2. **üß™ Staging –¥–µ–ø–ª–æ–π** - —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ staging —Å–µ—Ä–≤–µ—Ä
3. **üöÄ Production –¥–µ–ø–ª–æ–π** - —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ production —Å–µ—Ä–≤–µ—Ä
4. **üîÑ –û—Ç–∫–∞—Ç** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–∫–∞—Ç –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π

1. **Staging**: Push –≤ `main` –≤–µ—Ç–∫—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ–ø–ª–æ–∏—Ç –Ω–∞ staging
2. **Production**: –°–æ–∑–¥–∞–π—Ç–µ —Ç–µ–≥ `v1.0.0` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–µ–ª–∏–∑–∞

### –†—É—á–Ω–æ–π –¥–µ–ø–ª–æ–π

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ `Actions` –≤ GitHub
2. –í—ã–±–µ—Ä–∏—Ç–µ –Ω—É–∂–Ω—ã–π workflow
3. –ù–∞–∂–º–∏—Ç–µ `Run workflow`
4. –í—ã–±–µ—Ä–∏—Ç–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

### –õ–æ–∫–∞–ª—å–Ω—ã–π –¥–µ–ø–ª–æ–π

```bash
# Staging
./scripts/deploy.sh staging

# Production
./scripts/deploy.sh production

# –ë—ç–∫–∞–ø
./scripts/backup.sh production
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### GitHub Actions

- **–°—Ç–∞—Ç—É—Å**: –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Å—Ç–∞—Ç—É—Å –≤ —Ä–∞–∑–¥–µ–ª–µ `Actions`
- **–õ–æ–≥–∏**: –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–π—Ç–µ –ª–æ–≥–∏ –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞
- **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Slack/Email

### –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

- **Health Check**: `GET /api/test`
- **–ú–µ—Ç—Ä–∏–∫–∏**: `GET /api/metrics` (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ)
- **–õ–æ–≥–∏**: `docker-compose logs -f app`

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–µ—Ä–≤–µ—Ä–æ–≤

–í–∫–ª—é—á–∏—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ:
```bash
# –ó–∞–ø—É—Å–∫ —Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º
docker-compose -f docker-compose.prod.yml --profile monitoring up -d

# –î–æ—Å—Ç—É–ø –∫ Grafana
http://your-server:3001
# –õ–æ–≥–∏–Ω: admin / –ø–∞—Ä–æ–ª—å –∏–∑ GRAFANA_PASSWORD
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

1. **SSH –∫–ª—é—á–∏**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–ª—é—á–∏ –¥–ª—è staging/production
2. **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è**: –•—Ä–∞–Ω–∏—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ GitHub Secrets
3. **SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Let's Encrypt –∏–ª–∏ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
4. **Firewall**: –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –ø–æ—Ä—Ç–∞–º –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
5. **–†–µ–≥—É–ª—è—Ä–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**: –û–±–Ω–æ–≤–ª—è–π—Ç–µ Docker –æ–±—Ä–∞–∑—ã –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

### –ü—Ä–æ–≤–µ—Ä–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:

- **Snyk**: –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- **Trivy**: –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ Docker –æ–±—Ä–∞–∑–æ–≤
- **ESLint**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞
- **Rate Limiting**: –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ Nginx

## üõ†Ô∏è –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

1. **–û—à–∏–±–∫–∏ —Å–±–æ—Ä–∫–∏ Docker**
   ```bash
   # –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Dockerfile
   docker build -t test .
   ```

2. **–û—à–∏–±–∫–∏ –¥–µ–ø–ª–æ—è**
   ```bash
   # –ü—Ä–æ–≤–µ—Ä—å—Ç–µ SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
   ssh deploy@your-server
   
   # –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
   ls -la /opt/kelbetty-production
   ```

3. **–û—à–∏–±–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö**
   ```bash
   # –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
   docker-compose exec postgres psql -U kelbetty_user -d kelbetty
   ```

4. **–û—à–∏–±–∫–∏ Nginx**
   ```bash
   # –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
   docker-compose exec nginx nginx -t
   
   # –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏
   docker-compose logs nginx
   ```

### –û—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π:

```bash
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–∫–∞—Ç —á–µ—Ä–µ–∑ GitHub Actions
# –ò–ª–∏ —Ä—É—á–Ω–æ–π –æ—Ç–∫–∞—Ç:
git revert HEAD
git push origin main
```

## üìà –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ:

1. **Load Balancer**: –î–æ–±–∞–≤—å—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
2. **Database**: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é PostgreSQL
3. **CDN**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ CloudFlare –∏–ª–∏ AWS CloudFront
4. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: –î–æ–±–∞–≤—å—Ç–µ Redis –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è

### –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ:

1. **–†–µ—Å—É—Ä—Å—ã**: –£–≤–µ–ª–∏—á—å—Ç–µ –ª–∏–º–∏—Ç—ã –≤ docker-compose.prod.yml
2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Prometheus + Grafana
3. **–ê–ª–µ—Ä—Ç—ã**: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–æ–≤

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ GitHub Actions
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–æ–≤
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
4. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∫–æ–º–∞–Ω–¥–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

---

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –≠—Ç–æ—Ç CI/CD –ø–∞–π–ø–ª–∞–π–Ω –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞. –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –∏–∑ `DOCKER_README.md`.
